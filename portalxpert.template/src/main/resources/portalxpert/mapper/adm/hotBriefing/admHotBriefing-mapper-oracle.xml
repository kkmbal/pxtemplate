<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="portalxpert.adm.hotBriefing.mapper.AdmHotBriefingMapper">
	<!-- 핫브리핑조회 -->
	<select id="getAdmHotBriefingList" parameterType="portalxpert.adm.hotBriefing.vo.AdmHotBriefingVO" resultType="portalxpert.adm.hotBriefing.vo.AdmHotBriefingVO">
	SELECT A.BNR_ID
		, A.TITLE	
		, A.LINK_URL    
		, A.TARGETING    
		, A.CONTENTS    
		, A.IMGUSE_YN    
		, A.USE_YN
		, A.ALT_TXT
		, A.IMG_WIDTH
		, A.IMG_HEIGHT
		, A.IMG_SIZE	
		, A.IMG_PATH                                                                
		, A.IMG_NAME_REAL                                                             
		, A.FROM_DTS
		, A.TO_DTS
	FROM (
		SELECT S.BNR_ID
			, S.TITLE	
			, S.LINK_URL    
			, S.TARGETING    
			, S.CONTENTS    
			, S.IMGUSE_YN    
			, S.USE_YN
			, S.ALT_TXT
			, S.IMG_WIDTH
			, S.IMG_HEIGHT
			, S.IMG_SIZE	
			, S.IMG_PATH                                                                  
			, S.IMG_NAME_REAL                                                             
			, S.FROM_DTS
			, S.TO_DTS
		   , ROWNUM RNUM			
		FROM (
		    SELECT A.BNR_ID
				, A.TITLE	
				, A.LINK_URL    
				, A.TARGETING    
				, A.CONTENTS    
				, A.IMGUSE_YN    
				, A.USE_YN
				, A.ALT_TXT
				, A.IMG_WIDTH
				, A.IMG_HEIGHT
				, (SELECT IMG_SIZE FROM HOT_BRIEFING_FILE WHERE BNR_ID = A.BNR_ID) IMG_SIZE
				, B.IMG_PATH                                                                
				, B.IMG_NAME_REAL
				, A.FROM_DTS
				, A.TO_DTS
			FROM HOT_BRIEFING A, HOT_BRIEFING_FILE B                                            
			WHERE A.BNR_ID = B.BNR_ID(+)
			<if test="searchCondition=='title'">
				AND A.TITLE LIKE '%'|| #{searchKeyword} || '%'
			</if>
			<if test = "useYn!=null">
				AND A.USE_YN = #{useYn}
			</if> 
			ORDER BY A.BNR_ID DESC
		) S 
	) A
	<![CDATA[ WHERE ROWNUM <= #{recordCountPerPage} and RNUM > #{firstIndex} ]]>
	</select>
	
	<!-- 배너조회  건수-->
	<select id="getAdmHotBriefingListToCnt" parameterType="portalxpert.adm.hotBriefing.vo.AdmHotBriefingVO" resultType="int">
		SELECT  COUNT(1)															
		FROM HOT_BRIEFING A, HOT_BRIEFING_FILE B                                            
		WHERE A.BNR_ID = B.BNR_ID(+)
		<if test="searchCondition=='title'">
			AND A.TITLE LIKE '%'|| #{searchKeyword} || '%'
		</if>
		<if test = "useYn!=null">
			AND A.USE_YN = #{useYn}
		</if> 
	</select>
	
	
	<!-- 핫브리핑상세 -->			
	<select id="getAdmHotBriefing" parameterType="portalxpert.adm.hotBriefing.vo.AdmHotBriefingVO" resultType="portalxpert.adm.hotBriefing.vo.AdmHotBriefingVO">
		SELECT BNR_ID 					  
				, TITLE                    
				, LINK_URL                 
				, TARGETING                  
				, CONTENTS                     
				, IMGUSE_YN  
				, ALT_TXT                 
				, SORT                
				, USE_YN               
				, IMG_WIDTH
				, IMG_HEIGHT
				, FROM_DTS
				, TO_DTS                 
		FROM HOT_BRIEFING            
		WHERE BNR_ID = #{bnrId} 
	</select>
	
	
	<!-- 핫브리핑이미지 조회 -->			
	<select id="getAdmHotBriefingAppendImg" parameterType="portalxpert.adm.hotBriefing.vo.AdmHotBriefingVO" resultType="portalxpert.adm.hotBriefing.vo.AdmHotBriefingVO">
		SELECT FILE_ID
				, BNR_ID
				, IMG_NAME_ORG
				, IMG_NAME_REAL
				, IMG_SIZE
				, IMG_PATH
				, IMG_WIDTH
				, IMG_HEIGHT
		FROM HOT_BRIEFING_FILE  
		WHERE BNR_ID = #{bnrId}
		<if test = "fileId!=null">
			AND FILE_ID = DECODE(#{fileId}, '', FILE_ID, #{fileId})
		</if> 
	</select>
	
	<select id="getAdmHotBriefingId" resultType="java.lang.String">
		SELECT	(LPAD(TO_CHAR(NVL(MAX(BNR_ID),0)+1), '6', '0')) MAX_BNR_ID
		FROM	HOT_BRIEFING
	</select>
	
	<!-- 핫브리핑 등록 -->
	<insert id="insertAdmHotBriefing" parameterType="portalxpert.adm.hotBriefing.vo.AdmHotBriefingVO">
		INSERT INTO HOT_BRIEFING (                                                                                                       
			BNR_ID
			, TITLE
			, LINK_URL
			, ALT_TXT
			, SORT
			, USE_YN
			, IMG_WIDTH
			, IMG_HEIGHT
			, FROM_DTS
			, TO_DTS
			, INS_ID
			, INS_DTS
			, TARGETING
			, CONTENTS
			, IMGUSE_YN	
		)                                                                                                       
		VALUES                                                                                                  
		(
			#{bnrId}
			, #{title, javaType=String, jdbcType=VARCHAR}
			, #{linkUrl, javaType=String, jdbcType=VARCHAR}
			, #{altTxt, javaType=String, jdbcType=VARCHAR}
			, #{sort, javaType=Long, jdbcType=NUMERIC} 
			, #{useYn, javaType=String, jdbcType=VARCHAR}
			, #{imgWidth, javaType=Long, jdbcType=NUMERIC}
			, #{imgHeight, javaType=Long, jdbcType=NUMERIC}
			, #{fromDts, javaType=String, jdbcType=VARCHAR}
			, #{toDts, javaType=String, jdbcType=VARCHAR}
			, #{insId}
			, TO_CHAR(SYSDATE,'YYYYMMDDHHMISS')  
			, #{targeting, javaType=String, jdbcType=VARCHAR}   
			, #{contents, javaType=String, jdbcType=VARCHAR}    
			, #{imguseYn, javaType=String, jdbcType=VARCHAR}                                              
		)                                                                                                       
	</insert>
	
	<!-- 핫브리핑이미지 등록 -->
	<insert id="hotbriefingInnoApUpload" parameterType="portalxpert.adm.hotBriefing.vo.AdmHotBriefingVO">
		INSERT INTO HOT_BRIEFING_FILE (                                                                                                     
         	FILE_ID                                                                                            
	 			, BNR_ID																	           
         	, IMG_NAME_ORG 
         	, IMG_NAME_REAL 
         	, IMG_SIZE 
         	, IMG_PATH																     
       	)                                                                                                     
     	VALUES                                                                                                
      ( 
      	(SELECT (LPAD(TO_CHAR((SELECT NVL(MAX(FILE_ID),0)+1 FROM HOT_BRIEFING_FILE)), '6', '0')) FROM DUAL)
        	, #{bnrId}    
        	, #{imgNameOrg, javaType=String, jdbcType=VARCHAR}
        	, #{imgNameReal, javaType=String, jdbcType=VARCHAR}
        	, #{imgSize, javaType=Long, jdbcType=NUMERIC}
        	, #{imgPath, javaType=String, jdbcType=VARCHAR}                                                                                        
		)                                                                                                       
	</insert>
	
	<!-- 핫브리핑수정 -->
	<update id="updateAdmHotBriefing" parameterType="portalxpert.adm.hotBriefing.vo.AdmHotBriefingVO">
		UPDATE HOT_BRIEFING         
		SET	                                                                                             
			TITLE = #{title, javaType=String, jdbcType=VARCHAR}
			, LINK_URL = #{linkUrl, javaType=String, jdbcType=VARCHAR} 
			, ALT_TXT = #{altTxt, javaType=String, jdbcType=VARCHAR}
			, SORT = #{sort, javaType=Long, jdbcType=NUMERIC}
			, USE_YN = #{useYn, javaType=String, jdbcType=VARCHAR}
			, IMG_WIDTH = #{imgWidth, javaType=Long, jdbcType=NUMERIC}
			, IMG_HEIGHT = #{imgHeight, javaType=Long, jdbcType=NUMERIC}
			, FROM_DTS = #{fromDts, javaType=String, jdbcType=VARCHAR}
			, TO_DTS = #{toDts, javaType=String, jdbcType=VARCHAR}
			, UPD_ID = #{updId}
			, UPD_DTS = TO_CHAR(SYSDATE,'YYYYMMDDHHMISS') 
			, TARGETING = #{targeting, javaType=String, jdbcType=VARCHAR}
			, CONTENTS = #{contents, javaType=String, jdbcType=VARCHAR}
			, IMGUSE_YN = #{imguseYn, javaType=String, jdbcType=VARCHAR}
 		WHERE BNR_ID = #{bnrId}    
	</update>	
	
	<!-- 핫브리핑이미지수정 -->
	<!-- as-is와 동일하게 작성:로직확인필요 -->
	<insert id="updateAdmHotBriefingAppendImg" parameterType="portalxpert.adm.hotBriefing.vo.AdmHotBriefingVO">
		INSERT INTO HOT_BRIEFING_FILE                                                                                             
			(                                                                                                     
			FILE_ID                                                                                            
	 		, BNR_ID																	           
         	, IMG_NAME_ORG 
         	, IMG_NAME_REAL 
         	, IMG_SIZE 
         	, IMG_PATH														     
       		)                                                                                                     
		VALUES                                                                                                
       		((SELECT (LPAD(TO_CHAR((SELECT NVL(MAX(FILE_ID),0)+1 FROM HOT_BRIEFING_FILE)), '6', '0')) FROM DUAL)
         	, #{bnrId}    
         	, #{imgNameOrg, javaType=String, jdbcType=VARCHAR}
         	, #{imgNameReal, javaType=String, jdbcType=VARCHAR}
         	, #{imgSize, javaType=Long, jdbcType=NUMERIC}
         	, #{imgPath, javaType=String, jdbcType=VARCHAR}                                                                                    
       )  
	</insert>	
	
	<!-- 핫브리핑삭제(단건) -->
	<delete id="deleteAdmHotBriefing"  parameterType="portalxpert.adm.hotBriefing.vo.AdmHotBriefingVO">
		DELETE                     
  		FROM HOT_BRIEFING         
		WHERE BNR_ID = #{bnrId}  
	</delete>	
	
	<!-- 핫브리핑이미지삭제(단건) -->
	<delete id="deleteAdmHotBriefingAppendImg"  parameterType="portalxpert.adm.hotBriefing.vo.AdmHotBriefingVO">
		DELETE                     
  		FROM HOT_BRIEFING_FILE         
		WHERE BNR_ID = #{bnrId}  
	</delete>	
	

	<!-- 핫브리핑삭제(다건) -->
	<delete id="deleteAdmHotBriefings"  parameterType="portalxpert.adm.hotBriefing.vo.AdmHotBriefingVO">
		DELETE                     
  		FROM HOT_BRIEFING         
		WHERE BNR_ID IN ( ${bnrCheckbox} ) 
	</delete>	
	
	<!-- 핫브리핑이미지삭제(다건) -->
	<delete id="deleteAdmHotBriefingAppendImgs"  parameterType="portalxpert.adm.hotBriefing.vo.AdmHotBriefingVO">
		DELETE                     
  		FROM HOT_BRIEFING_FILE         
		WHERE BNR_ID IN ( ${bnrCheckbox} )
	</delete>	
</mapper>
